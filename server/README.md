# OpenAPI generated server

## Overview
This server was generated by the [OpenAPI Generator](https://openapi-generator.tech) project. By using the
[OpenAPI-Spec](https://openapis.org) from a remote server, the server stub was generated driven by
the [Connexion](https://github.com/zalando/connexion) library on top of aiohttp.

## Requirements
Python 3.5.2+

## Usage
To run the server, please execute the following from the root directory:

```
pip3 install -r requirements.txt
python3 -m athenian.api --state-db sqlite:// --metadata-db sqlite:// --ui
```

You may replace `sqlite://` (in-memory zero-configuration sample DB stub) with a real
[SQLAlchemy connection string](https://docs.sqlalchemy.org/en/13/core/engines.html).

and open your browser to here:

```
http://localhost:8080/v1/ui/
```

Your OpenAPI definition lives here:

```
http://localhost:8080/v1/openapi.json
```

To launch the integration tests, use pytest:
```
sudo pip install -r test-requirements.txt
pytest
```

## Operations

[Deployment.](DEPLOYMENT.md)

[DB migration.](server/athenian/api/models/state/README.md)

Prometheus monitoring: `http://localhost:8080/status`.

## Development

Install the linters:

```
pip install -r lint-requirements.txt
```

Validate you changes:

```
cd server
flake8
```

Generate a sample SQLite metadata DB:

```
docker run --rm -e DB_DIR=/io -v$(pwd):/io --entrypoint python3 athenian/api /server/tests/gen_sqlite_db.py
``` 

## Running the API server locally

Alternatively, you can locally build and run the docker image:

```
# Build the API image
docker build -t athenian/api .

# Generate metadata db with fixtures
docker run --rm -e DB_DIR=/io -v$(pwd):/io --entrypoint python3 athenian/api /server/tests/gen_sqlite_db.py

# Run the API container
docker run --rm -p 8080:8080 -v$(pwd):/io athenian/api --ui --metadata-db=sqlite:///io/db.sqlite --state-db=sqlite://
```

And open http://localhost:8080/v1/ui

## Prevent file overriding

After the first generation, add edited files to _.openapi-generator-ignore_ to prevent generator to overwrite them. Typically:
```
server/controllers/*
test/*
*.txt
```
